<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>链接缩短器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
        color: #333;
    }
    .container {
        width: 100%;
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        background-color: #fff;
    }
    h1 {
        color: #333;
        margin-bottom: 1.5rem;
        text-align: center;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        color: #555;
    }
    input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
    }
    input:focus {
        outline: none;
        border-color: #279cff;
    }
    button {
        width: 100%;
        padding: 0.75rem;
        background-color: #279cff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
        margin-top: 0.5rem;
    }
    button:hover {
        background-color: #2180d8;
    }
    .link-item {
        display: flex;
        margin-bottom: 1rem;
        align-items: center;
    }
    .link-item input {
        flex: 1;
        margin-right: 0.5rem;
    }
    .link-item button {
        width: auto;
        padding: 0.5rem 1rem;
        margin-top: 0;
        background-color: #ff4d4d;
    }
    .link-item button:hover {
        background-color: #e60000;
    }
    #linksList {
        margin-bottom: 1.5rem;
    }
    .copyright {
        text-align: center;
        margin: 2rem 0 1rem 0;
        color: #999;
        font-size: 14px;
    }
    .copyright a {
        text-decoration: none;
        font-weight: bold;
        color: #999;
        transition: opacity 0.2s;
    }
    .copyright a:hover {
        opacity: 0.5;
    }
    .error-message {
        color: red;
        margin-top: 1rem;
        text-align: center;
    }
    @media (max-width: 768px) {
        .container {
            width: 95%;
            padding: 1.5rem;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <h1>链接缩短器</h1>
        <div id="loginSection" class="form-group">
            <label for="passwordInput">请输入密码</label>
            <input type="password" id="passwordInput" placeholder="输入密码">
            <button onclick="authenticate()">登录</button>
        </div>
        <div id="linksSection" style="display: none;">
            <div id="linksList"></div>
            <div class="form-group">
                <label for="newShortUrl">新短链接</label>
                <input id="newShortUrl" placeholder="输入新短链接">
            </div>
            <div class="form-group">
                <label for="newLink">新链接</label>
                <input id="newLink" placeholder="输入新链接">
            </div>
            <button onclick="addLink()">添加链接</button>
            <button onclick="saveLinks()">保存所有链接</button>
        </div>
        <div id="errorMessage" class="error-message"></div>
    </div>
    <div class="copyright">
        Copyright &copy; 2023-2024
        <a href="https://jerryz.com.cn" target="_blank">Jerry Zhou</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        let links = {};
        const githubToken = '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';
        const repoOwner = 'YangguangZhou';
        const repoName = 'suri';
        const filePath = 'src/links.json';
        const password = '080506Jerry';

        function checkAuth() {
            const authStatus = localStorage.getItem('authStatus');
            if (authStatus === 'true') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('linksSection').style.display = 'block';
                fetchLinks();
            }
        }

        function authenticate() {
            const passwordInput = document.getElementById('passwordInput').value;
            if (passwordInput === password) {
                localStorage.setItem('authStatus', 'true');
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('linksSection').style.display = 'block';
                fetchLinks();
            } else {
                showError('密码错误');
            }
        }

        async function fetchLinks() {
            try {
                const response = await axios.get(
                    `https://cdn.jerryz.com.cn/gh/$${repoOwner}/$${repoName}@master/$${filePath}`
                );
                links = response.data;
                displayLinks();
            } catch (error) {
                console.error('Failed to fetch links:', error);
                showError('获取链接失败，请重试');
            }
        }

        function displayLinks() {
            const linksList = document.getElementById('linksList');
            linksList.innerHTML = '';
            for (const [shortUrl, link] of Object.entries(links)) {
                const linkItem = document.createElement('div');
                linkItem.className = 'link-item';
                linkItem.innerHTML = `
                    <input value="$${shortUrl}" onchange="updateShortUrl('$${shortUrl}', this.value)">
                    <input value="$${link}" onchange="updateLink('$${shortUrl}', this.value)">
                    <button onclick="removeLink('$${shortUrl}')"><i class="fas fa-trash"></i></button>
                `;
                linksList.appendChild(linkItem);
            }
        }

        function addLink() {
            const shortUrl = document.getElementById('newShortUrl').value;
            const link = document.getElementById('newLink').value;
            if (shortUrl && link) {
                links[shortUrl] = link;
                displayLinks();
                document.getElementById('newShortUrl').value = '';
                document.getElementById('newLink').value = '';
            } else {
                showError('请输入短链接和链接');
            }
        }

        function updateShortUrl(oldShortUrl, newShortUrl) {
            if (oldShortUrl !== newShortUrl) {
                links[newShortUrl] = links[oldShortUrl];
                delete links[oldShortUrl];
                displayLinks();
            }
        }

        function updateLink(shortUrl, newLink) {
            links[shortUrl] = newLink;
        }

        function removeLink(shortUrl) {
            delete links[shortUrl];
            displayLinks();
        }

        async function saveLinks() {
            try {
                const content = btoa(JSON.stringify(links, null, 2));
                const response = await axios.put(`https://api.github.com/repos/$${repoOwner}/$${repoName}/contents/$${filePath}`, {
                    message: 'Update links',
                    content: content,
                    sha: await getCurrentFileSHA()
                }, {
                    headers: { 'Authorization': `token $${githubToken}` }
                });

                if (response.status === 200) {
                    alert('链接已保存到GitHub');
                } else {
                    throw new Error('Failed to save links');
                }
            } catch (error) {
                console.error('Failed to save links:', error);
                showError('保存链接失败，请重试');
            }
        }

        async function getCurrentFileSHA() {
            try {
                const response = await axios.get(`https://api.github.com/repos/$${repoOwner}/$${repoName}/contents/$${filePath}`, {
                    headers: { 'Authorization': `token $${githubToken}` }
                });
                return response.data.sha;
            } catch (error) {
                console.error('Failed to get current file SHA:', error);
                throw error;
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            setTimeout(() => {
                errorElement.textContent = '';
            }, 3000);
        }

        // 页面加载时检查认证状态
        window.onload = checkAuth;
    </script>
</body>
</html>